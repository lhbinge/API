index_plot <- cbind(index_plot,Simple_ps.RS=sps.RS_index[2:62,1])
index_plot <- cbind(index_plot,Full_ps.RS=ps.RS_results[2:62,2])
index_plot <- index_plot[,-2]
index_plot <- time_results
index_plot$Date <- c("2000Q2","2000Q3","2000Q4","2001Q1","2001Q2","2001Q3","2001Q4","2002Q1","2002Q2","2002Q3","2002Q4",
"2003Q1","2003Q2","2003Q3","2003Q4","2004Q1","2004Q2","2004Q3","2004Q4","2005Q1","2005Q2","2005Q3","2005Q4",
"2006Q1","2006Q2","2006Q3","2006Q4","2007Q1","2007Q2","2007Q3","2007Q4","2008Q1","2008Q2","2008Q3","2008Q4",
"2009Q1","2009Q2","2009Q3","2009Q4","2010Q1","2010Q2","2010Q3","2010Q4","2011Q1","2011Q2","2011Q3","2011Q4",
"2012Q1","2012Q2","2012Q3","2012Q4","2013Q1","2013Q2","2013Q3","2013Q4","2014Q1","2014Q2","2014Q3","2014Q4",
"2015Q1","2015Q2")
repeatsales_index$Date <- c("2001Q3","2001Q4","2002Q1","2002Q2","2002Q3","2002Q4",
"2003Q1","2003Q2","2003Q3","2003Q4","2004Q1","2004Q2","2004Q3","2004Q4","2005Q1","2005Q2","2005Q3","2005Q4",
"2006Q1","2006Q2","2006Q3","2006Q4","2007Q1","2007Q2","2007Q3","2007Q4","2008Q1","2008Q2","2008Q3","2008Q4",
"2009Q1","2009Q2","2009Q3","2009Q4","2010Q1","2010Q2","2010Q3","2010Q4","2011Q1","2011Q2","2011Q3","2011Q4",
"2012Q1","2012Q2","2012Q3","2012Q4","2013Q1","2013Q2","2013Q3","2013Q4","2014Q1","2014Q2","2014Q3","2014Q4",
"2015Q1","2015Q2")
index_plot <- merge(index_plot, repeatsales_index, by="Date", all=TRUE)
index_plot <- cbind(index_plot,Simple_ps.RS=sps.RS_index[2:62,1])
index_plot <- cbind(index_plot,Full_ps.RS=ps.RS_results[2:62,2])
index_plot <- index_plot[,-2]
#png(file = "Repeat Sales.png", width=600,height=360)
index_plot <- melt(index_plot, id="Date")  # convert to long format
g <- ggplot(data=index_plot,aes(x=Date, y=value, group=variable, colour=variable))
g <- g + geom_point(size = 3)
g <- g + geom_line()
g <- g + ylab("Index")
g <- g + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.position="bottom") + theme(legend.title=element_blank())
g
k <- 1
teller <-0
fullrep <- data.frame()
fullrep1<- data.frame()
fullrep2 <- data.frame()
fullrep3<- data.frame()
fullrep4 <- data.frame()
fullrep5<- data.frame()
fullrep6 <- data.frame()
fullrep7<- data.frame()
rartdata <- subset(artdata,artdata$rank_all<max(artdata$rank_all,na.rm=TRUE))
keep <- c("lnprice","artist","lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy","counter")
rartdata <- rartdata[,names(rartdata) %in% keep]
rartdata <- rartdata[complete.cases(rartdata),]
## Rank total again for new sample
rankings <- count(rartdata, artist)
rankings$rank_total <- row_number(desc(rankings$n))
rartdata <- merge(rartdata, rankings, by.x="artist", by.y="artist",all.x=TRUE)
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
if(length(levels(modeldata$timedummy))!=1) { #modeldata$timedummy <- as.numeric(0)
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
#modeldata$fitted <- rowSums(fitted)
#modeldata <- modeldata[!is.na(modeldata$fitted),]
#try id manually:
modeldata$id <- 0
)
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
#modeldata$fitted <- rowSums(fitted)
#modeldata <- modeldata[!is.na(modeldata$fitted),]
#try id manually:
modeldata$id <- 0
View(modeldata)
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
#modeldata$id[(modeldata$distance==min(modeldata[modeldata[,"id"]==0,"distance"],na.rm=TRUE))] <- teller
if(modeldata$distance<0.01 & modeldata[modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)) {modeldata$id <- teller}
}
}
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.1 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium),] <- teller
}
}
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.1 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.01 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
teller <-0
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.01 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
teller <-0
fullrep <- data.frame()
fullrep1<- data.frame()
fullrep2 <- data.frame()
fullrep3<- data.frame()
fullrep4 <- data.frame()
fullrep5<- data.frame()
fullrep6 <- data.frame()
fullrep7<- data.frame()
rartdata <- subset(artdata,artdata$rank_all<max(artdata$rank_all,na.rm=TRUE))
keep <- c("lnprice","artist","lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy","counter")
rartdata <- rartdata[,names(rartdata) %in% keep]
rartdata <- rartdata[complete.cases(rartdata),]
## Rank total again for new sample
rankings <- count(rartdata, artist)
rankings$rank_total <- row_number(desc(rankings$n))
rartdata <- merge(rartdata, rankings, by.x="artist", by.y="artist",all.x=TRUE)
k
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
list_expl_vars <- c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy")
expl_vars <- as.formula(paste("lnprice~",paste(list_expl_vars,collapse="+")))
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
modeldata$timedummy <- modeldata$timedummy[1]
modeldata <- cbind(modeldata,fitted=predict.lm(model))
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.01 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
list_expl_vars <- c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy")
expl_vars <- as.formula(paste("lnprice~",paste(list_expl_vars,collapse="+")))
teller <-0
fullrep <- data.frame()
fullrep1<- data.frame()
fullrep2 <- data.frame()
fullrep3<- data.frame()
fullrep4 <- data.frame()
fullrep5<- data.frame()
fullrep6 <- data.frame()
fullrep7<- data.frame()
rartdata <- subset(artdata,artdata$rank_all<max(artdata$rank_all,na.rm=TRUE))
keep <- c("lnprice","artist","lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy","counter")
rartdata <- rartdata[,names(rartdata) %in% keep]
rartdata <- rartdata[complete.cases(rartdata),]
## Rank total again for new sample
rankings <- count(rartdata, artist)
rankings$rank_total <- row_number(desc(rankings$n))
rartdata <- merge(rartdata, rankings, by.x="artist", by.y="artist",all.x=TRUE)
for(k in 1:max(rartdata$rank_total)) {
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
if(length(levels(modeldata$timedummy))!=1) { #modeldata$timedummy <- as.numeric(0)
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
#modeldata$fitted <- rowSums(fitted)
#modeldata <- modeldata[!is.na(modeldata$fitted),]
#try id manually:
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.01 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
repdata <- repsaledata(modeldata$lnprice,modeldata$counter,modeldata$id)
fullrep <- rbind(fullrep,repdata)
repdata1 <- repsaledata(modeldata$lnarea,modeldata$counter,modeldata$id)
fullrep1 <- rbind(fullrep1,repdata1)
repdata2 <- repsaledata(modeldata$med_code,modeldata$counter,modeldata$id)
fullrep2 <- rbind(fullrep2,repdata2)
repdata3 <- repsaledata(modeldata$ah_code,modeldata$counter,modeldata$id)
fullrep3 <- rbind(fullrep3,repdata3)
repdata4 <- repsaledata(modeldata$lnsculpt_area,modeldata$counter,modeldata$id)
fullrep4 <- rbind(fullrep4,repdata4)
repdata5 <- repsaledata(modeldata$dum_signed,modeldata$counter,modeldata$id)
fullrep5 <- rbind(fullrep5,repdata5)
repdata6 <- repsaledata(modeldata$dum_dated,modeldata$counter,modeldata$id)
fullrep6 <- rbind(fullrep6,repdata6)
repdata7 <- repsaledata(modeldata$nr_works,modeldata$counter,modeldata$id)
fullrep7 <- rbind(fullrep7,repdata7)
}
}
fullrep <- cbind(fullrep,fullrep1[,4:5])
fullrep <- cbind(fullrep,fullrep2[,4:5])
fullrep <- cbind(fullrep,fullrep3[,4:5])
fullrep <- cbind(fullrep,fullrep4[,4:5])
fullrep <- cbind(fullrep,fullrep5[,4:5])
fullrep <- cbind(fullrep,fullrep6[,4:5])
fullrep <- cbind(fullrep,fullrep7[,4:5])
View(fullrep)
colnames(fullrep) <- c("id","time0","time1","price0","price1","area0","area1","med_code0","med_code1",
"ah_code0","ah_code1","sculpt0","sculpt1","sign0","sign1","date0","date1",
"nr0","nr1")
repeatsales <- repsale(fullrep$price0,fullrep$time0,fullrep$price1,fullrep$time1,mergefirst=3,
graph=TRUE,graph.conf=TRUE,conf=.95)
sps.RS_index <- exp(as.data.frame(repeatsales$pindex))*100
dy <- fullrep$price1 - fullrep$price0
timevar <- levels(factor(c(fullrep$time0, fullrep$time1)))
nt = length(timevar)
n = length(dy)
xmat <- array(0, dim = c(n, nt - 1))
for (j in seq(1 + 1, nt)) {
xmat[, j - 1] <- ifelse(fullrep$time1 == timevar[j], 1, xmat[, j - 1])
xmat[, j - 1] <- ifelse(fullrep$time0 == timevar[j],-1, xmat[, j - 1])
}
colnames(xmat) <- paste("Time", seq(1 + 1, nt))
fit <- lm(dy ~ xmat + 0)
fullrep$med_code0[is.na(fullrep$med_code0)] <- "Oil"
fullrep$med_code1[is.na(fullrep$med_code1)] <- "Oil"
fullrep$ah_code0[is.na(fullrep$ah_code0)] <- "Strauss"
fullrep$ah_code1[is.na(fullrep$ah_code1)] <- "Strauss"
darea <- fullrep$area1 - fullrep$area0
med0 <- model.matrix(~fullrep$med_code0)
med1 <- model.matrix(~fullrep$med_code1)
dmed <- med1 - med0
ah0 <- model.matrix(~fullrep$ah_code0)
ah1 <- model.matrix(~fullrep$ah_code1)
dah <- ah1 - ah0
dsculpt <- fullrep$sculpt1 - fullrep$sculpt0
dnr <- fullrep$nr1 - fullrep$nr0
sign0 <- model.matrix(~fullrep$sign0)
sign1 <- model.matrix(~fullrep$sign1)
dsign <- sign1 - sign0
date0 <- model.matrix(~fullrep$date0)
date1 <- model.matrix(~fullrep$date1)
ddate <- date1 - date0
#ps.RS <- lm(dy ~ darea + dmed + dah + dsculpt + dnr + dsign + ddate + xmat + 0)
ps.RS <- lm(dy ~ darea + dah + dsculpt + dnr + dsign + ddate + xmat + 0)
ps.RS_results <- summary(ps.RS)$coefficients[grepl("Time", rownames(summary(ps.RS)$coefficients)),1]
ps.RS_results <- as.data.frame(ps.RS_results)
ps.RS_results$index_all <- exp(ps.RS_results$ps.RS_results)*100
teller <-0
fullrep <- data.frame()
fullrep1<- data.frame()
fullrep2 <- data.frame()
fullrep3<- data.frame()
fullrep4 <- data.frame()
fullrep5<- data.frame()
fullrep6 <- data.frame()
fullrep7<- data.frame()
rartdata <- subset(artdata,artdata$rank_all<max(artdata$rank_all,na.rm=TRUE))
keep <- c("lnprice","artist","lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy","counter")
rartdata <- rartdata[,names(rartdata) %in% keep]
rartdata <- rartdata[complete.cases(rartdata),]
## Rank total again for new sample
rankings <- count(rartdata, artist)
rankings$rank_total <- row_number(desc(rankings$n))
rartdata <- merge(rartdata, rankings, by.x="artist", by.y="artist",all.x=TRUE)
for(k in 1:max(rartdata$rank_total)) {
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
if(length(levels(modeldata$timedummy))!=1) { #modeldata$timedummy <- as.numeric(0)
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
#modeldata$fitted <- rowSums(fitted)
#modeldata <- modeldata[!is.na(modeldata$fitted),]
#try id manually:
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.001 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
repdata <- repsaledata(modeldata$lnprice,modeldata$counter,modeldata$id)
fullrep <- rbind(fullrep,repdata)
repdata1 <- repsaledata(modeldata$lnarea,modeldata$counter,modeldata$id)
fullrep1 <- rbind(fullrep1,repdata1)
repdata2 <- repsaledata(modeldata$med_code,modeldata$counter,modeldata$id)
fullrep2 <- rbind(fullrep2,repdata2)
repdata3 <- repsaledata(modeldata$ah_code,modeldata$counter,modeldata$id)
fullrep3 <- rbind(fullrep3,repdata3)
repdata4 <- repsaledata(modeldata$lnsculpt_area,modeldata$counter,modeldata$id)
fullrep4 <- rbind(fullrep4,repdata4)
repdata5 <- repsaledata(modeldata$dum_signed,modeldata$counter,modeldata$id)
fullrep5 <- rbind(fullrep5,repdata5)
repdata6 <- repsaledata(modeldata$dum_dated,modeldata$counter,modeldata$id)
fullrep6 <- rbind(fullrep6,repdata6)
repdata7 <- repsaledata(modeldata$nr_works,modeldata$counter,modeldata$id)
fullrep7 <- rbind(fullrep7,repdata7)
}
}
fullrep <- cbind(fullrep,fullrep1[,4:5])
fullrep <- cbind(fullrep,fullrep2[,4:5])
fullrep <- cbind(fullrep,fullrep3[,4:5])
fullrep <- cbind(fullrep,fullrep4[,4:5])
fullrep <- cbind(fullrep,fullrep5[,4:5])
fullrep <- cbind(fullrep,fullrep6[,4:5])
fullrep <- cbind(fullrep,fullrep7[,4:5])
colnames(fullrep) <- c("id","time0","time1","price0","price1","area0","area1","med_code0","med_code1",
"ah_code0","ah_code1","sculpt0","sculpt1","sign0","sign1","date0","date1",
"nr0","nr1")
repeatsales <- repsale(fullrep$price0,fullrep$time0,fullrep$price1,fullrep$time1,mergefirst=3,
graph=TRUE,graph.conf=TRUE,conf=.95)
sps.RS_index <- exp(as.data.frame(repeatsales$pindex))*100
list_expl_vars <- c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy")
expl_vars <- as.formula(paste("lnprice~",paste(list_expl_vars,collapse="+")))
teller <-0
fullrep <- data.frame()
fullrep1<- data.frame()
fullrep2 <- data.frame()
fullrep3<- data.frame()
fullrep4 <- data.frame()
fullrep5<- data.frame()
fullrep6 <- data.frame()
fullrep7<- data.frame()
rartdata <- subset(artdata,artdata$rank_all<max(artdata$rank_all,na.rm=TRUE))
keep <- c("lnprice","artist","lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated",
"nr_works","timedummy","counter")
rartdata <- rartdata[,names(rartdata) %in% keep]
rartdata <- rartdata[complete.cases(rartdata),]
## Rank total again for new sample
rankings <- count(rartdata, artist)
rankings$rank_total <- row_number(desc(rankings$n))
rartdata <- merge(rartdata, rankings, by.x="artist", by.y="artist",all.x=TRUE)
for(k in 1:max(rartdata$rank_total)) {
modeldata <- subset(rartdata, rartdata$rank_total==k)
modeldata$med_code <- factor(modeldata$med_code)
modeldata$ah_code <- factor(modeldata$ah_code)
modeldata$dum_signed <- factor(modeldata$dum_signed)
modeldata$dum_dated <- factor(modeldata$dum_dated)
modeldata$timedummy <- factor(modeldata$timedummy)
#modeldata <- cbind(modeldata,model.matrix(~modeldata$med_code))
if(length(levels(modeldata$med_code))==1)   { modeldata$med_code <- as.numeric(0) }
if(length(levels(modeldata$ah_code))==1)    { modeldata$ah_code <- as.numeric(0) }
if(length(levels(modeldata$dum_signed))==1) { modeldata$dum_signed <- as.numeric(0) }
if(length(levels(modeldata$dum_dated))==1)  { modeldata$dum_dated <- as.numeric(0)   }
if(length(levels(modeldata$timedummy))!=1) { #modeldata$timedummy <- as.numeric(0)
model <- lm(expl_vars, data=modeldata, na.action = na.exclude)
#calculate predicted value for each painting (excluding time dummies)
#newdata <- modeldata
#newdata$timedummy <- modeldata$timedummy[1]
modeldata$timedummy <- modeldata$timedummy[1]
#pr <- which(!(newdata$med_code %in% levels(modeldata$med_code)))
#newdata$med_code[pr] <- NA
#modeldata <- cbind(modeldata,fitted=predict.lm(model,newdata))
#fitted<-as.data.frame(predict.lm(model,newdata,type="terms",na.action = na.exclude,
#        terms = c("lnarea","ah_code","med_code","lnsculpt_area","dum_signed","dum_dated","nr_works")))
modeldata <- cbind(modeldata,fitted=predict.lm(model))
#modeldata$fitted <- rowSums(fitted)
#modeldata <- modeldata[!is.na(modeldata$fitted),]
#try id manually:
modeldata$id <- 0
for(i in 1:nrow(modeldata)) {
teller <- teller + 1
if(modeldata$id[i]==0) {
modeldata$id[i] <- teller
medium <- modeldata$med_code[i]
modeldata$distance <- abs(modeldata$fitted[i]-modeldata$fitted)
modeldata$id[(modeldata$distance<0.1 & modeldata[,"id"]==0 & modeldata[,"med_code"]==medium)] <- teller
}
}
repdata <- repsaledata(modeldata$lnprice,modeldata$counter,modeldata$id)
fullrep <- rbind(fullrep,repdata)
repdata1 <- repsaledata(modeldata$lnarea,modeldata$counter,modeldata$id)
fullrep1 <- rbind(fullrep1,repdata1)
repdata2 <- repsaledata(modeldata$med_code,modeldata$counter,modeldata$id)
fullrep2 <- rbind(fullrep2,repdata2)
repdata3 <- repsaledata(modeldata$ah_code,modeldata$counter,modeldata$id)
fullrep3 <- rbind(fullrep3,repdata3)
repdata4 <- repsaledata(modeldata$lnsculpt_area,modeldata$counter,modeldata$id)
fullrep4 <- rbind(fullrep4,repdata4)
repdata5 <- repsaledata(modeldata$dum_signed,modeldata$counter,modeldata$id)
fullrep5 <- rbind(fullrep5,repdata5)
repdata6 <- repsaledata(modeldata$dum_dated,modeldata$counter,modeldata$id)
fullrep6 <- rbind(fullrep6,repdata6)
repdata7 <- repsaledata(modeldata$nr_works,modeldata$counter,modeldata$id)
fullrep7 <- rbind(fullrep7,repdata7)
}
}
fullrep <- cbind(fullrep,fullrep1[,4:5])
fullrep <- cbind(fullrep,fullrep2[,4:5])
fullrep <- cbind(fullrep,fullrep3[,4:5])
fullrep <- cbind(fullrep,fullrep4[,4:5])
fullrep <- cbind(fullrep,fullrep5[,4:5])
fullrep <- cbind(fullrep,fullrep6[,4:5])
fullrep <- cbind(fullrep,fullrep7[,4:5])
colnames(fullrep) <- c("id","time0","time1","price0","price1","area0","area1","med_code0","med_code1",
"ah_code0","ah_code1","sculpt0","sculpt1","sign0","sign1","date0","date1",
"nr0","nr1")
repeatsales <- repsale(fullrep$price0,fullrep$time0,fullrep$price1,fullrep$time1,mergefirst=3,
graph=TRUE,graph.conf=TRUE,conf=.95)
sps.RS_index <- exp(as.data.frame(repeatsales$pindex))*100
